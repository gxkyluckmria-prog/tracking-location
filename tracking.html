<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crime Live Map</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<!-- Leaflet Search CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

<style>
    html, body { height: 100%; margin: 0; font-family: Arial, sans-serif; }
    #map { width: 100%; height: 100%; }
    .controls {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.7);
        padding: 10px 15px;
        border-radius: 8px;
        color: white;
        z-index: 1000;
    }
    .controls label { display: block; margin: 5px 0; }
</style>
</head>
<body>

<div class="controls">
    <strong>Crime Filters:</strong>
    <label><input type="checkbox" class="crime-type" value="Robbery" checked> Robbery</label>
    <label><input type="checkbox" class="crime-type" value="Assault" checked> Assault</label>
    <label><input type="checkbox" class="crime-type" value="Theft" checked> Theft</label>
</div>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<!-- Leaflet Heatmap Plugin -->
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
<!-- Leaflet Search/Geocoder -->
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

<script>
// Initialize map
const map = L.map('map').setView([-6.7924, 39.2083], 13);

// Add tile layer
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Add search control
L.Control.geocoder({position: 'topright'}).addTo(map);

// Example crime data
let crimes = [
    {lat: -6.7924, lng: 39.2083, type: "Robbery"},
    {lat: -6.7900, lng: 39.2150, type: "Assault"},
    {lat: -6.7950, lng: 39.2100, type: "Theft"}
];

// Create marker layer and heatmap layer
let markers = L.layerGroup().addTo(map);
let heat = L.heatLayer([], {radius: 25, blur: 15}).addTo(map);

// Function to update map
function updateMap() {
    const selectedTypes = Array.from(document.querySelectorAll('.crime-type:checked')).map(c => c.value);

    // Clear layers
    markers.clearLayers();
    heat.setLatLngs([]);

    const heatPoints = [];
    crimes.forEach(crime => {
        if (selectedTypes.includes(crime.type)) {
            // Marker
            const marker = L.marker([crime.lat, crime.lng])
                .bindPopup(`<b>Type:</b> ${crime.type}<br><b>Time:</b> ${new Date().toLocaleString()}`);
            markers.addLayer(marker);

            // Heat point
            heatPoints.push([crime.lat, crime.lng, 1]);
        }
    });
    heat.setLatLngs(heatPoints);
}

// Initial update
updateMap();

// Add event listener to checkboxes
document.querySelectorAll('.crime-type').forEach(cb => cb.addEventListener('change', updateMap));

// Simulate live updates
setInterval(() => {
    // Randomly add or move crimes
    crimes = crimes.map(c => ({
        lat: c.lat + (Math.random()-0.5)/500,
        lng: c.lng + (Math.random()-0.5)/500,
        type: c.type
    }));
    updateMap();
}, 10000);

</script>
</body>
</html>
