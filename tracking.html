<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GX LIVE TRACKING</title>

<style>
#map {
  width: 100%;
  height: 70vh;
}
input, button {
  padding: 10px;
  font-size: 18px;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>

<script>
// ---------------- F I R E B A S E ----------------
const firebaseConfig = {
  apiKey: "AIzaSyCc5yrARvCo5w6ZVKuEaE4YuILcC4rJ0Sk",
  authDomain: "gx-tracking.firebaseapp.com",
  databaseURL: "https://gx-tracking-default-rtdb.firebaseio.com",
  projectId: "gx-tracking",
  storageBucket: "gx-tracking.firebasestorage.app",
  messagingSenderId: "194870704198",
  appId: "1:194870704198:web:131779ab69c562a5213247",
  measurementId: "G-0PLG7WG6NX"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDO2oNMk5OQHlw3tK6A9_GLee-0iP56fyA"></script>

</head>
<body>

<h2>GX LIVE MOVEMENT TRACKING</h2>

<div id="map"></div>

<br>
<input id="phone" placeholder="Enter phone number">
<button onclick="sendLink()">Send Tracking Link</button>

<p id="generatedLink" style="color:#0f0;"></p>

<script>
// =========== GENERATE TRACK LINK ===========
function sendLink(){
  let phone = document.getElementById("phone").value;
  let uid = "user123"; 
  let link = window.location.origin + "/capture.html?uid=" + uid;

  document.getElementById("generatedLink").innerHTML =
      "Send this link: " + link;
}

// =========== GOOGLE MAP ==============
let map, marker;

function initMap(){
  map = new google.maps.Map(document.getElementById("map"), {
    center: {lat: -6.8, lng: 39.2},
    zoom: 17,
    tilt: 60,
    heading: 90,
    mapId: "a3efe1c35b0e4a48"
  });

  marker = new google.maps.Marker({
    map,
    animation: google.maps.Animation.BOUNCE
  });

  // listen firebase
  db.ref("users/user123").on("value", snap => {
    if(!snap.val()) return;
    let lat = snap.val().lat;
    let lng = snap.val().lng;

    let pos = {lat, lng};
    marker.setPosition(pos);
    map.setCenter(pos);
  });
}

initMap();
</script>

</body>
</html>
